# 词库同步与工作流

仓库内的 `i18n/zh-cn.json` 可以作为“主要维护入口”。但当前脚本变体对词库的接入方式不同，需要做一次同步。

## 推荐工作流

1. 在 `i18n/zh-cn.json` 新增/修正翻译条目。
2. 按你选择的脚本变体，将词库同步到脚本可读取的形式：
   - `old1.user.js`：内置词库（直接写入 `I18N`）
   - `old2.user.js`：外置词库（生成 `Vercel-i18n-Data.js` 并通过 `@require` 引入）
3. 在 Vercel 页面验证命中效果，确认没有误翻/漏翻。

## 自动去重与规范化

仓库会在 `main` 分支收到推送后，自动对 `i18n/zh-cn.json` 做去重与规范化，并在有变化时提交一个由 bot 生成的提交回仓库。

你可能会看到：

- 你推送后出现一个额外的 `chore: autoremove duplicates ...` 提交
- 词库文件被统一缩进/换行风格

这些属于维护性改动，目的是避免“重复 key”与不一致格式导致的合并冲突与误判。

## 同步到 old1.user.js（内置词库）

- 将 `i18n/zh-cn.json` 的键值对合并到 `scripts/old1.user.js` 的 `I18N` 对象中。
- 避免加入过宽的“删词”规则（例如把高频词映射为空字符串），这类规则容易造成大面积副作用。

## 同步到 old2.user.js（外置词库）

`old2.user.js` 依赖 `window.VERCEL_I18N_DATA`。因此外置词库文件需要是“普通脚本”，在全局写入该变量。

外置词库文件形态示例：

```js
window.VERCEL_I18N_DATA = {
  "Overview": "概览"
};
```

注意事项：

- 该文件不能使用 `export`/`import`（因为 `@require` 以普通脚本方式加载）。
- 需要保证文件可被脚本平台稳定访问（例如 GreasyFork 的 update 域名）。
- 若 `window.VERCEL_I18N_DATA` 为空对象，`old2.user.js` 会认为词库加载失败。

## 冲突处理建议

当你在同步或合并分支时遇到同一个 key 出现多个译文：

1. 先确定最终译文（只保留一条），不要依赖“重复 key 覆盖”。
2. 更新 `i18n/zh-cn.json` 后再做同步，让脚本侧的词库与 JSON 保持一致。
3. 如遇到 bot 提交引入的格式化差异，优先保留去重后的结果，再继续处理业务冲突。

## 何时用规则替代词库

遇到包含动态片段的文本（数字、时间、分支名等），建议将“静态部分”保留在词库，而把动态部分交给规则处理（例如正则替换）。这样可以避免枚举大量变体，也更抗 UI 文案细微变动。
