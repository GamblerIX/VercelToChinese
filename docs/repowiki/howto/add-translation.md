# 新增/修正翻译

本项目采用“精确匹配为主，少量正则规则补充”的方式。优先让 key 与页面上出现的英文文本完全一致，再补充中文译文。

## 基本原则

- 保持 key 精确：大小写、标点、空格都可能影响命中。
- 避免过宽翻译：不要把高频通用词（例如单个冠词、介词）翻成空字符串或不相关含义。
- 优先短句与 UI 文案：越长的段落越容易随版本变动失配。
- 避免重复 key：一个 key 对应一个译文；同 key 多译文先做取舍再提交。

## 冲突与取舍

当同一个英文 key 出现多个中文译文候选时，建议按以下顺序取舍：

1. 以产品语义为准：不要只按字面直译，优先贴近控制台实际含义。
2. 以一致性为准：同一概念在不同页面/不同位置应尽量使用同一译法。
3. 以可读性为准：尽量使用更短、更自然的中文 UI 用语，减少括号解释。

例如：`Observability` 在本仓库词库中统一使用“监控”。

## 在 old1.user.js 中维护

`scripts/old1.user.js` 将词库内置在 `I18N` 对象中，并在 `REGEX_RULES` 中处理部分动态文本（例如时间、分支提示）。

建议流程：

1. 在页面上复制未翻译的英文文本（尽量复制到“完整的短句”）。
2. 在 `I18N` 中增加或修正条目（`"英文": "中文"`）。
3. 如果该文本包含动态片段（数字、分支名等），优先在 `REGEX_RULES` 增加规则，而不是枚举大量变体。

注意：`old1.user.js` 的翻译函数会对 key 做 `trim()`，文本节点替换时也可能影响原始空白字符展示；新增条目时尽量以“去掉首尾空白后的英文”为 key。

## 在 old2.user.js 中维护

`scripts/old2.user.js` 的脚本逻辑通过 `@require` 引入外部词库脚本，并从 `window.VERCEL_I18N_DATA` 读取数据。

仓库内提供了 `i18n/zh-cn.json` 作为词库样例/存档，但当前 `old2.user.js` 不会直接读取该 JSON 文件。

建议流程（两种路径二选一）：

- 使用 `old2.user.js`：把翻译条目同步到外部词库脚本对应的数据源（需要在分发端更新）。
- 使用仓库内词库：将 `i18n/zh-cn.json` 作为主要维护入口，并选择不依赖 `@require` 的脚本变体（例如以 `old1.user.js` 为基础演进）。

如果你希望以 `i18n/zh-cn.json` 为主入口，并同时兼容两种脚本变体，参考 [词库同步与工作流](sync-dictionary.md)。

## 如何定位未命中文案

- 先确认文本是否位于黑名单节点内（例如 `CODE` / `PRE` / 编辑器区域）；这类区域通常刻意跳过翻译。
- 文案可能被拆分成多个文本节点：需要分别为各个片段补充 key。
- 文案可能由图标按钮的 `aria-label`、输入框的 `placeholder` 提供：这类文本需要在“属性翻译”路径下补齐 key。
